import{S as Fe,i as Ne,s as De,j as ce,k as L,l as ee,m as fe,n as H,o as ue,f as F,u as C,w as de,x as B,v as _e,d as c,r as he,a9 as We,e as g,t as W,c as k,a as E,g as U,H as u,h as te,b as I,Z as le,G as pe,$ as me,aa as Ue,ab as be,I as ne}from"../../chunks/vendor-b3a12ac3.js";import{g as Le}from"../../chunks/navigation-51f4a605.js";import{F as He}from"../../chunks/Weather-186ca2b9.js";import"../../chunks/Variety-ab1a983c.js";import{L as Pe,G as Re}from"../../chunks/GeoJson-374c29c6.js";import{H as Be}from"../../chunks/Header-5712565a.js";import"../../chunks/singletons-12a22614.js";import"../../chunks/preload-helper-ec9aa979.js";let V,ve=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ve.decode();let ae=null;function Q(){return(ae===null||ae.buffer!==V.memory.buffer)&&(ae=new Uint8Array(V.memory.buffer)),ae}function ge(t,e){return ve.decode(Q().subarray(t,t+e))}const z=new Array(32).fill(void 0);z.push(void 0,null,!0,!1);let X=z.length;function ke(t){X===z.length&&z.push(z.length+1);const e=X;return X=z[e],z[e]=t,e}function we(t){return z[t]}function Ve(t){t<36||(z[t]=X,X=t)}function ye(t){const e=we(t);return Ve(t),e}let x=0;function Me(t,e){const a=e(t.length*1);return Q().set(t,a/1),x=t.length,a}function Ce(t){var e=Me(t,V.__wbindgen_malloc),a=x,n=V.getFeaturesFromShape(e,a);return ye(n)}let se=new TextEncoder("utf-8");const ze=typeof se.encodeInto=="function"?function(t,e){return se.encodeInto(t,e)}:function(t,e){const a=se.encode(t);return e.set(a),{read:t.length,written:a.length}};function Ge(t,e,a){if(a===void 0){const h=se.encode(t),_=e(h.length);return Q().subarray(_,_+h.length).set(h),x=h.length,_}let n=t.length,l=e(n);const s=Q();let i=0;for(;i<n;i++){const h=t.charCodeAt(i);if(h>127)break;s[l+i]=h}if(i!==n){i!==0&&(t=t.slice(i)),l=a(l,n,n=i+t.length*3);const h=Q().subarray(l+i,l+n);i+=ze(t,h).written}return x=i,l}let re=null;function Ee(){return(re===null||re.buffer!==V.memory.buffer)&&(re=new Int32Array(V.memory.buffer)),re}async function qe(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(n){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const a=await t.arrayBuffer();return await WebAssembly.instantiate(a,e)}else{const a=await WebAssembly.instantiate(t,e);return a instanceof WebAssembly.Instance?{instance:a,module:t}:a}}async function je(t){const e={};e.wbg={},e.wbg.__wbindgen_json_parse=function(l,s){var i=JSON.parse(ge(l,s));return ke(i)},e.wbg.__wbg_new_693216e109162396=function(){var l=new Error;return ke(l)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(l,s){var i=we(s).stack,h=Ge(i,V.__wbindgen_malloc,V.__wbindgen_realloc),_=x;Ee()[l/4+1]=_,Ee()[l/4+0]=h},e.wbg.__wbg_error_09919627ac0992f5=function(l,s){try{console.error(ge(l,s))}finally{V.__wbindgen_free(l,s)}},e.wbg.__wbindgen_object_drop_ref=function(l){ye(l)},(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:a,module:n}=await qe(await t,e);return V=a.exports,je.__wbindgen_wasm_module=n,V}var Je="/_app/assets/geo-utils_bg-1f56cca5.wasm";function Te(t,e,a){const n=t.slice();return n[6]=e[a],n[7]=e,n[8]=a,n}function Se(t,e,a){const n=t.slice();return n[9]=e[a],n}function Ke(t){var P;let e,a,n,l,s,i,h,_,p,r,d,T,A,N,S=Object.keys(((P=t[1][0])==null?void 0:P.field.geojson.properties)||{}),v=[];for(let o=0;o<S.length;o+=1)v[o]=$e(Se(t,S,o));let y=t[0]&&Ie(t);return{c(){e=g("p"),a=W("Select field name column."),n=L(),l=g("select"),s=g("option"),i=W("Select field name");for(let o=0;o<v.length;o+=1)v[o].c();h=L(),_=g("p"),p=W("Select fields to import."),r=L(),y&&y.c(),d=ee(),this.h()},l(o){e=k(o,"P",{class:!0});var j=E(e);a=U(j,"Select field name column."),j.forEach(c),n=H(o),l=k(o,"SELECT",{class:!0});var O=E(l);s=k(O,"OPTION",{});var $=E(s);i=U($,"Select field name"),$.forEach(c);for(let D=0;D<v.length;D+=1)v[D].l(O);O.forEach(c),h=H(o),_=k(o,"P",{class:!0});var R=E(_);p=U(R,"Select fields to import."),R.forEach(c),r=H(o),y&&y.l(o),d=ee(),this.h()},h(){I(e,"class","text-lg font-bold"),s.selected=!0,s.disabled=!0,s.__value="Select field name",s.value=s.__value,I(l,"class","select select-bordered select-primary w-full max-w-xs mb-4"),t[0]===void 0&&Ue(()=>t[4].call(l)),I(_,"class","text-lg font-bold mb-4")},m(o,j){F(o,e,j),u(e,a),F(o,n,j),F(o,l,j),u(l,s),u(s,i);for(let O=0;O<v.length;O+=1)v[O].m(l,null);be(l,t[0]),F(o,h,j),F(o,_,j),u(_,p),F(o,r,j),y&&y.m(o,j),F(o,d,j),T=!0,A||(N=le(l,"change",t[4]),A=!0)},p(o,j){var O;if(j&2){S=Object.keys(((O=o[1][0])==null?void 0:O.field.geojson.properties)||{});let $;for($=0;$<S.length;$+=1){const R=Se(o,S,$);v[$]?v[$].p(R,j):(v[$]=$e(R),v[$].c(),v[$].m(l,null))}for(;$<v.length;$+=1)v[$].d(1);v.length=S.length}j&3&&be(l,o[0]),o[0]?y?(y.p(o,j),j&1&&B(y,1)):(y=Ie(o),y.c(),B(y,1),y.m(d.parentNode,d)):y&&(he(),C(y,1,1,()=>{y=null}),de())},i(o){T||(B(y),T=!0)},o(o){C(y),T=!1},d(o){o&&c(e),o&&c(n),o&&c(l),me(v,o),o&&c(h),o&&c(_),o&&c(r),y&&y.d(o),o&&c(d),A=!1,N()}}}function Ye(t){let e,a,n,l,s,i,h,_;return{c(){e=g("div"),a=g("label"),n=g("span"),l=W("Shapefile"),s=L(),i=g("input"),this.h()},l(p){e=k(p,"DIV",{class:!0});var r=E(e);a=k(r,"LABEL",{class:!0});var d=E(a);n=k(d,"SPAN",{});var T=E(n);l=U(T,"Shapefile"),T.forEach(c),s=H(d),i=k(d,"INPUT",{id:!0,type:!0,class:!0}),d.forEach(c),r.forEach(c),this.h()},h(){I(i,"id","file"),I(i,"type","file"),I(i,"class","input input-bordered input-lg input-file"),I(a,"class","input-group input-group-vertical input-group-lg"),I(e,"class","form-control")},m(p,r){F(p,e,r),u(e,a),u(a,n),u(n,l),u(a,s),u(a,i),h||(_=le(i,"change",t[2]),h=!0)},p:ne,i:ne,o:ne,d(p){p&&c(e),h=!1,_()}}}function $e(t){let e,a=t[9]+"",n,l;return{c(){e=g("option"),n=W(a),this.h()},l(s){e=k(s,"OPTION",{});var i=E(e);n=U(i,a),i.forEach(c),this.h()},h(){e.__value=l=t[9],e.value=e.__value},m(s,i){F(s,e,i),u(e,n)},p(s,i){i&2&&a!==(a=s[9]+"")&&te(n,a),i&2&&l!==(l=s[9])&&(e.__value=l,e.value=e.__value)},d(s){s&&c(e)}}}function Ie(t){let e,a,n,l,s,i,h,_,p,r,d,T,A,N,S,v,y,P=t[1].filter(Oe).length+"",o,j,O,$,R,D=t[1],b=[];for(let f=0;f<D.length;f+=1)b[f]=Ae(Te(t,D,f));const oe=f=>C(b[f],1,1,()=>{b[f]=null});return{c(){e=g("div"),a=g("table"),n=g("thead"),l=g("tr"),s=g("th"),i=L(),h=g("th"),_=W("Field"),p=L(),r=g("th"),d=W("Name"),T=L(),A=g("tbody");for(let f=0;f<b.length;f+=1)b[f].c();N=L(),S=g("div"),v=g("button"),y=W("Import "),o=W(P),j=W(" Fields"),this.h()},l(f){e=k(f,"DIV",{class:!0});var m=E(e);a=k(m,"TABLE",{class:!0});var w=E(a);n=k(w,"THEAD",{});var G=E(n);l=k(G,"TR",{});var M=E(l);s=k(M,"TH",{class:!0}),E(s).forEach(c),i=H(M),h=k(M,"TH",{class:!0});var K=E(h);_=U(K,"Field"),K.forEach(c),p=H(M),r=k(M,"TH",{class:!0});var Y=E(r);d=U(Y,"Name"),Y.forEach(c),M.forEach(c),G.forEach(c),T=H(w),A=k(w,"TBODY",{});var Z=E(A);for(let ie=0;ie<b.length;ie+=1)b[ie].l(Z);Z.forEach(c),w.forEach(c),m.forEach(c),N=H(f),S=k(f,"DIV",{class:!0});var J=E(S);v=k(J,"BUTTON",{type:!0,class:!0});var q=E(v);y=U(q,"Import "),o=U(q,P),j=U(q," Fields"),q.forEach(c),J.forEach(c),this.h()},h(){I(s,"class","w-10"),I(h,"class","w-24 text-center"),I(r,"class","w-auto"),I(a,"class","table table-fixed table-zebra w-full"),I(e,"class","overflow-x-auto"),I(v,"type","submit"),I(v,"class","btn btn-primary w-full"),I(S,"class","sticky bottom-16 z-50")},m(f,m){F(f,e,m),u(e,a),u(a,n),u(n,l),u(l,s),u(l,i),u(l,h),u(h,_),u(l,p),u(l,r),u(r,d),u(a,T),u(a,A);for(let w=0;w<b.length;w+=1)b[w].m(A,null);F(f,N,m),F(f,S,m),u(S,v),u(v,y),u(v,o),u(v,j),O=!0,$||(R=le(v,"click",t[3]),$=!0)},p(f,m){if(m&2){D=f[1];let w;for(w=0;w<D.length;w+=1){const G=Te(f,D,w);b[w]?(b[w].p(G,m),B(b[w],1)):(b[w]=Ae(G),b[w].c(),B(b[w],1),b[w].m(A,null))}for(he(),w=D.length;w<b.length;w+=1)oe(w);de()}(!O||m&2)&&P!==(P=f[1].filter(Oe).length+"")&&te(o,P)},i(f){if(!O){for(let m=0;m<D.length;m+=1)B(b[m]);O=!0}},o(f){b=b.filter(Boolean);for(let m=0;m<b.length;m+=1)C(b[m]);O=!1},d(f){f&&c(e),me(b,f),f&&c(N),f&&c(S),$=!1,R()}}}function Ze(t){let e,a;return e=new Re({props:{geojson:t[6].field.geojson,zoomTo:!0}}),{c(){ce(e.$$.fragment)},l(n){fe(e.$$.fragment,n)},m(n,l){ue(e,n,l),a=!0},p(n,l){const s={};l&2&&(s.geojson=n[6].field.geojson),e.$set(s)},i(n){a||(B(e.$$.fragment,n),a=!0)},o(n){C(e.$$.fragment,n),a=!1},d(n){_e(e,n)}}}function Qe(t){let e,a;return{c(){e=g("i"),a=W("Please select name field above...")},l(n){e=k(n,"I",{});var l=E(e);a=U(l,"Please select name field above..."),l.forEach(c)},m(n,l){F(n,e,l),u(e,a)},p:ne,d(n){n&&c(e)}}}function Xe(t){let e,a=t[6].field.name+"",n;return{c(){e=g("strong"),n=W(a)},l(l){e=k(l,"STRONG",{});var s=E(e);n=U(s,a),s.forEach(c)},m(l,s){F(l,e,s),u(e,n)},p(l,s){s&2&&a!==(a=l[6].field.name+"")&&te(n,a)},d(l){l&&c(e)}}}function Ae(t){let e,a,n,l,s,i,h,_,p,r,d,T,A,N,S,v=t[6].field.area.toFixed(1)+"",y,P,o,j,O,$;d=new Pe({props:{class:"h-full",zoomControl:!1,dragable:!1,zoomable:!1,$$slots:{default:[Ze]},$$scope:{ctx:t}}});function R(f,m){return f[6].field.name?Xe:Qe}let D=R(t),b=D(t);function oe(){return t[5](t[6],t[7],t[8])}return{c(){e=g("tr"),a=g("th"),n=g("label"),l=g("input"),i=L(),h=g("td"),_=g("div"),p=g("div"),r=g("div"),ce(d.$$.fragment),T=L(),A=g("td"),b.c(),N=L(),S=g("div"),y=W(v),P=W(" ac."),o=L(),this.h()},l(f){e=k(f,"TR",{});var m=E(e);a=k(m,"TH",{});var w=E(a);n=k(w,"LABEL",{});var G=E(n);l=k(G,"INPUT",{type:!0,class:!0}),G.forEach(c),w.forEach(c),i=H(m),h=k(m,"TD",{});var M=E(h);_=k(M,"DIV",{class:!0});var K=E(_);p=k(K,"DIV",{class:!0});var Y=E(p);r=k(Y,"DIV",{class:!0});var Z=E(r);fe(d.$$.fragment,Z),Z.forEach(c),Y.forEach(c),K.forEach(c),M.forEach(c),T=H(m),A=k(m,"TD",{});var J=E(A);b.l(J),N=H(J),S=k(J,"DIV",{class:!0});var q=E(S);y=U(q,v),P=U(q," ac."),q.forEach(c),J.forEach(c),o=H(m),m.forEach(c),this.h()},h(){I(l,"type","checkbox"),I(l,"class","checkbox checkbox"),l.checked=s=t[6].checked,I(r,"class","w-16 h-16 mask mask-squircle"),I(p,"class","avatar"),I(_,"class","flex items-left space-x-3"),I(S,"class","text-sm opacity-50"),pe(e,"active",t[6].checked)},m(f,m){F(f,e,m),u(e,a),u(a,n),u(n,l),u(e,i),u(e,h),u(h,_),u(_,p),u(p,r),ue(d,r,null),u(e,T),u(e,A),b.m(A,null),u(A,N),u(A,S),u(S,y),u(S,P),u(e,o),j=!0,O||($=le(e,"click",oe),O=!0)},p(f,m){t=f,(!j||m&2&&s!==(s=t[6].checked))&&(l.checked=s);const w={};m&4098&&(w.$$scope={dirty:m,ctx:t}),d.$set(w),D===(D=R(t))&&b?b.p(t,m):(b.d(1),b=D(t),b&&(b.c(),b.m(A,N))),(!j||m&2)&&v!==(v=t[6].field.area.toFixed(1)+"")&&te(y,v),m&2&&pe(e,"active",t[6].checked)},i(f){j||(B(d.$$.fragment,f),j=!0)},o(f){C(d.$$.fragment,f),j=!1},d(f){f&&c(e),_e(d),b.d(),O=!1,$()}}}function xe(t){let e,a,n,l,s,i;e=new Be({props:{title:"Upload field(s)",backPath:"/fields"}});const h=[Ye,Ke],_=[];function p(r,d){return r[1].length===0?0:1}return n=p(t),l=_[n]=h[n](t),{c(){ce(e.$$.fragment),a=L(),l.c(),s=ee()},l(r){fe(e.$$.fragment,r),a=H(r),l.l(r),s=ee()},m(r,d){ue(e,r,d),F(r,a,d),_[n].m(r,d),F(r,s,d),i=!0},p(r,[d]){let T=n;n=p(r),n===T?_[n].p(r,d):(he(),C(_[T],1,1,()=>{_[T]=null}),de(),l=_[n],l?l.p(r,d):(l=_[n]=h[n](r),l.c()),B(l,1),l.m(s.parentNode,s))},i(r){i||(B(e.$$.fragment,r),B(l),i=!0)},o(r){C(e.$$.fragment,r),C(l),i=!1},d(r){_e(e,r),r&&c(a),_[n].d(r),r&&c(s)}}}const Oe=t=>t.checked;function et(t,e,a){let n="",l=[];async function s(p){var d;const r=p.target;if(r.files){let T=await((d=r.files[0])==null?void 0:d.arrayBuffer());if(!T){a(1,l=[]);return}await je(Je);let A=Ce(new Uint8Array(T));a(1,l=A.map(N=>({checked:!1,field:new He("",N.geojson,N.area,N.center)})))}}async function i(){for(const p of l)p.checked&&await p.field.save();Le("/fields")}function h(){n=We(this),a(0,n),a(1,l),a(0,n)}const _=(p,r,d)=>a(1,r[d].checked=!p.checked,l);return t.$$.update=()=>{t.$$.dirty&3&&a(1,l=l.map(p=>{var d,T;let r=((T=(d=p.field)==null?void 0:d.geojson)==null?void 0:T.properties)?p.field.geojson.properties:{};return Object.assign(p.field,p.field,{name:r[n]}),p}))},[n,l,s,i,h,_]}class ct extends Fe{constructor(e){super();Ne(this,e,et,xe,De,{})}}export{ct as default};
